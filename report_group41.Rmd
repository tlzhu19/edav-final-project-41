---
title: "Refugee Resettlements in the USA"
author: "Ji In Choi (jic2124), Jung Ah Shin (js5569), Olivia Wang (yw3324), Tiffany Zhu (tz2196)"
date: "December 5, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

## Data Sources

## Data Transformation
```{r}
library(readxl)
library(tidyverse)


clean_arrival <- function(file, sheet_name) {
  dat <- read_excel(file, sheet = sheet_name)
  dat1 <- subset(dat, select = c(...6, ...8,...9))
  dat2 <-subset(dat, select = c(...15,...18,...19)) 
  dat3 <-subset(dat, select = c(...23,...25,...27))

  dat1<-dat1 %>% drop_na()
  dat2<-dat2 %>% drop_na()
  dat3<-dat3 %>% drop_na()

  # set first row (State, Cases, Inds) as column name
  colnames(dat1) <- as.character(unlist(dat1[1,]))
  dat1 = dat1[-1, ]
  colnames(dat2) <- as.character(unlist(dat2[1,]))
  dat2 = dat2[-1, ]
  colnames(dat3) <- as.character(unlist(dat3[1,]))
  dat3 = dat3[-1, ]

  # Grouping columns together
  combined <- rbind(dat1,dat2)
  combined <- rbind(combined,dat3)

  # State,Cases,Inds

  combined$Cases <-as.numeric(as.character(combined$Cases))
  combined$Inds <-as.numeric(as.character(combined$Inds))
  
  return (combined)
}


```

```{r}
clean_demographics <- function(file, sheet_name) {
  df <- read_excel(file, sheet = sheet_name)
  
  if (sheet_name == 'Age Group') {
    column_names = c('Department of State','...2', '...3', '...4')
  }
  else if (sheet_name == 'Religion') {
    column_names = c('Department of State','...2', '...4', '...6')
  }
  else if (sheet_name == 'Ethnicity' | sheet_name == 'Education' | sheet_name == 'Native Language') {
    column_names = c('Department of State','...2', '...3', '...5')
  }
  
  df2 <- subset(df, select = column_names)
  df3 <- df2[complete.cases(df2), ]
  df4 = df3[-nrow(df3), ]

  colnames(df4) = c(sheet_name, 'Male', 'Female', 'Total')
  
  return(df4)
}

```

```{r}

combine_files <- function(path, data_cleaner, sheet_name, title) {
  df = data.frame()
  files <- list.files(path=path, pattern="*.xlsx", full.names=TRUE, recursive=FALSE)
  for (file in files){
    cleaned_data = data_cleaner(file, sheet_name)
    year_extract <- unlist(strsplit(file, title))
    cleaned_data$Year <- as.numeric(gsub(".xlsx", "", year_extract[2]))
    df <- rbind(df, cleaned_data)}
  return (df)
}
#Examples

# path = "~/Desktop/Projects/EDAV/edav-final-project-41/data/raw/demographics"
# title = 'Demographics_'
# function
# sheet_name = 'Ethnicity'
# sheet_name = 'Age Group'
# sheet_name = 'Religion'
# sheet_name = 'Education'
# sheet_name = 'Native Language'
# data_cleaner = clean_demographics

# path = "~/Desktop/Projects/EDAV/edav-final-project-41/data/raw/all_arrivals"
# title = 'Arrivals_'
# sheet_name = 'Detailed'
# data_cleaner = clean_arrival


# df_test3 <- combine_files(path, clean_demographics, sheet_name, title)
```


## Missing Values

## Results

## Interactive Component

## Conclusion
